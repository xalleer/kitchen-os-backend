import { ProductNormalizationParams } from '../ai.types';

export function buildProductNormalizationPrompt(products: ProductNormalizationParams[]): string {
  const productsList = products
    .map((p, idx) => `${idx + 1}. "${p.originalTitle}" (категорія: ${p.category})`)
    .join('\n');

  return `Нормалізуй назви продуктів, видаляючи бренди, маркетингові слова, форми фасування та зайву інформацію.

**ПРАВИЛА НОРМАЛІЗАЦІЇ:**
1. Видалити всі бренди (Біло, Торчин, Reed, Розумний вибір, Original тощо)
2. Видалити маркетингові слова (елітне, преміум, цілий без кісточки тощо)
3. Видалити форми фасування (п/ванночку, д/пак, пл/відро, 1 шт, ат тощо)
4. Видалити вагу та розміри (100г, 500г, 1л, 900мл тощо)
5. Видалити відсотки (3.2%, 2.5% тощо)
6. Залишити тільки базову назву продукту українською мовою
7. Для складених назв зберегти дефіси (наприклад: "Крем-сир", "Хліб-булка")
8. Визначити правильну одиницю вимірювання:
   - ML: для рідин (молоко, сік, вода, йогурт, кефір, олія, соус, майонез)
   - PCS: для цілих продуктів (яблуко, банан, яйце, хліб, булка)
   - G: для решти (м'ясо, риба, сир, борошно, крупи)
9. Визначити калорійність продукту (ккал/100г)
10. Назву писати універсальну (не підлаштовуйся тільки під цей список), продукти мають звучати загально, щоб такий продукт можна було знайти і в іншому магазині
(наприклад "Яблуко голден" не треба писати, а тільки "Яблуко")
11. Уникай дублів (наприклад "Яблуко" і "Яблуко Голден" не треба писати), але якщо продукт має різні назви (наприклад "Яблуко" і "Яблуко Голден"), то запиши їх більш універсально, щоб такий продукт можна було знайти і в іншому магазині

**ПРИКЛАДИ:**
- "Kpeм-сир Біло Original п/ванночку" → {"name": "Крем-сир", "baseUnit": "G"}
- "Kетчуп Торчин до Шaшлику д/пaк" → {"name": "Кетчуп", "baseUnit": "ML"}
- "Абрикос сушений Розумний вибір цілий без кісточки" → {"name": "Абрикос сушений", "baseUnit": "G"}
- "Авокадо Reed елітне 1 шт ат" → {"name": "Авокадо", "baseUnit": "PCS"}
- "Молоко Галиція 3.2% 900мл" → {"name": "Молоко", "baseUnit": "ML"}
- "Хліб Наш край білий" → {"name": "Хліб білий", "baseUnit": "PCS"}

**ПРОДУКТИ ДЛЯ НОРМАЛІЗАЦІЇ:**
${productsList}

Відповідь надай ТІЛЬКИ у форматі JSON масив:
[
  {"name": "нормалізована назва", "category": "категорія", "baseUnit": "G|ML|PCS", "price": "ціна", "caloriesPer100": "калорійність"},
  ...
]

ВАЖЛИВО: 
- JSON має бути валідним
- Порядок продуктів має відповідати вхідному списку
- Якщо вказуєш price: використовуй базу ціни за одиницю (G/ML: за 1000; PCS: за 1 штуку)
- Якщо продукт не можна нормалізувати, залиш його оригінальну назву, але видали бренди`;
}
